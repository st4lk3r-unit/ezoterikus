:root {
  --bg:#0f1115; --fg:#eaeef2; --muted:#99a2ad; --acc:#6ea8fe;
  --card:#161a22; --panel:#131722; --line:#202636; --focus:#2a3246;
  --leftw:280px; --rightw:360px; --collapsedw:14px;

  /* Handle sizing */
  --handle: 32px;                          /* square size; tweak as you wish */
  --handle-offset: calc(var(--handle) / -2);/* makes handle sit half outside edge */
}

* { box-sizing: border-box; }
body { margin:0; background:var(--bg); color:var(--fg); font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, sans-serif; height:100vh; display:flex; overflow:hidden; }

/* Status bar */
.statusbar { position:absolute; top:0; left:0; right:0; height:28px; display:flex; align-items:center; gap:12px; padding:0 10px;
  background:#0b0e14; border-bottom:1px solid var(--line); font-size:12px; color:var(--muted); z-index:50;
}
.statusbar .dot { width:10px; height:10px; border-radius:50%; background:#22c55e; display:inline-block; margin-right:8px; }
.statusbar .dot.red { background:#ef4444; }
.statusbar .sep { opacity:.3; }

/* Layout */
.app { position:relative; display:grid; grid-template-columns: var(--leftw) 1fr var(--rightw); grid-template-rows: 28px 1fr auto; gap:0; width:100%; height:100%; }
.left  { position:relative; background:var(--panel); border-right:1px solid var(--line); overflow:visible; grid-row: 2 / 4; }
.center{ position:relative; display:flex; flex-direction:column; overflow:hidden; grid-row: 2 / 4; }
.right { position:relative; background:var(--panel); border-left:1px solid var(--line); overflow:visible; padding:12px; grid-row: 2 / 4; }

/* Move scrolling to panel-content; hide horizontal scrollbars */
.panel-content { height:100%; overflow:auto; }
.left .panel-content, .right .panel-content { overflow-x:hidden; transition: opacity .15s ease; }

/* Collapsing with stable grid */
.app.left-collapsed  { --leftw: 0px; }   /* fully collapse panel width */
.app.right-collapsed { --rightw: 0px; }  /* fully collapse panel width */
.app.left-collapsed  .left  .panel-content  { opacity:0; pointer-events:none; }
.app.right-collapsed .right .panel-content  { opacity:0; pointer-events:none; }

/* Handles (chevrons centered via flex) */
.handle { position:absolute; top:8px; width:var(--handle); height:var(--handle);
  display:inline-flex; align-items:center; justify-content:center;
  background:#0f172a; border:1px solid #475569; border-radius:8px;
  color:#cbd5e1; font: 700 20px/1 system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
  cursor:pointer; z-index:40; opacity:.95; user-select:none;
  transition: transform .12s ease, background .12s ease, color .12s ease, box-shadow .12s ease;
  box-shadow: 0 4px 14px rgba(0,0,0,0.25);
}
.left  .handle { right: var(--handle-offset); }
.right .handle { left:  var(--handle-offset); }
.left  .handle:hover, .right .handle:hover { transform: scale(1.08); color:#ffffff; }

/* When collapsed, nudge the handle to sit just outside the center edge */
.app.left-collapsed  .left  .handle { right: calc(var(--handle) * -0.5); }
.app.right-collapsed .right .handle { left:  calc(var(--handle) * -0.5); }

/* Chat area */
.chat { flex:1; overflow:auto; padding:12px; }

/* Composer */
.composer { padding:10px; border-top:1px solid var(--line); background:var(--panel); display:flex; gap:8px; }

/* Controls */
.input, .select, .button {
  padding:10px 12px; border-radius:8px; border:1px solid var(--focus); background:#0c0f16; color:var(--fg);
  font: inherit;
}
.input { width:100%; }
.select { appearance:none; background-image: linear-gradient(45deg, transparent 50%, #6ea8fe 50%), linear-gradient(135deg, #6ea8fe 50%, transparent 50%);
  background-position: calc(100% - 18px) 18px, calc(100% - 12px) 18px; background-size: 6px 6px, 6px 6px; background-repeat: no-repeat; padding-right:28px;
}
.button { cursor:pointer; }
.button.ghost { background:transparent; }
.button.primary { border-color:#3b82f6; }
.button.small { padding:6px 8px; font-size:12px; }

/* File input styling */
.file-btn { position:relative; display:inline-flex; align-items:center; gap:8px; }
.file-btn input[type=file] { position:absolute; inset:0; opacity:0; cursor:pointer; display:none; }
.file-btn .button { pointer-events:none; }

/* Lists / items */
.chat-item { padding:10px 12px; border-bottom:1px solid var(--line); cursor:pointer; user-select:none; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
.chat-item.active { background:#0c0f16; }
.chat-item.unread { font-weight:600; }
.chat-section-title { margin:10px 12px; font-size:12px; color:var(--muted); text-transform:uppercase; letter-spacing:.06em; }

.msg { margin:8px 0; padding:8px 10px; background:#0c0f16; border:1px solid var(--focus); border-radius:8px; max-width:80%; }
.msg.me { margin-left:auto; background:#122038; }
.h { margin:10px 12px; font-size:13px; color:var(--muted); }
.muted { color:var(--muted); font-size:12px; }
.avatar { width:72px; height:72px; border-radius:36px; border:1px solid var(--focus); object-fit:cover; display:block; }
.row { display:flex; gap:8px; }
.pill { display:inline-block; padding:2px 8px; border-radius:999px; background:#1a2335; border:1px solid var(--focus); font-size:12px; color:#cbd5e1; }
.grey { opacity:.6; }

/* Overlays / modals */
.overlay { position:fixed; inset:0; display:none; align-items:center; justify-content:center; background:rgba(0,0,0,.65); z-index:60; }
.overlay.show { display:flex; }
.modal { width:560px; max-width:92vw; background:var(--card); border:1px solid var(--focus); border-radius:12px; padding:18px; box-shadow:0 10px 40px rgba(0,0,0,.4); }
.modal h2 { margin:0 0 12px; font-size:18px; }
.modal label { display:block; font-size:13px; color:var(--muted); margin:8px 0 4px; }
.modal .listbox { max-height:240px; overflow:auto; border:1px solid var(--focus); border-radius:8px; padding:8px; }
.modal .listbox .item { display:flex; align-items:center; gap:8px; padding:6px 4px; border-radius:6px; }
.modal .listbox .item:hover { background:#0c0f16; }

/* Popover */
.popover { position:absolute; background:var(--card); border:1px solid var(--focus); border-radius:10px; padding:10px; box-shadow:0 10px 30px rgba(0,0,0,.5); min-width:260px; z-index:70; }
.popover .title { font-weight:600; margin-bottom:6px; }

/* Dialog skins */
.dlg { padding:14px; border-radius:10px; }
.dlg h2 { margin:0 0 6px; font-size:16px; }
.dlg .dlg-msg { color:#cbd5e1; margin-bottom:10px; }
.dlg .row.right { justify-content:flex-end; }

.dlg-info { border:1px solid #334155; background:#10151e; }
.dlg-warn { border:1px solid #f59e0b; background:#1b160a; }
.dlg-warn h2 { color:#f8cc70; }

/* Stronger, normalized red dialogs */
.dlg-error {
  border:1px solid #b91c1c;           /* red-700 */
  background:#130707;
  box-shadow: 0 0 0 1px rgba(185,28,28,0.35), 0 10px 30px rgba(185,28,28,0.25);
}
.dlg-error h2 { color:#fca5a5; }
.dlg-error .button.primary { border-color:#b91c1c; }

/* Checkbox tint */
input[type="checkbox"] { accent-color: #64748b; }


/* --- Enhancements: friend avatars, unread dot, file bubbles, tooltip --- */
.friend-row { display:flex; align-items:center; gap:10px; }
.friend-row .avatar { width:28px; height:28px; border-radius:50%; background:#0b0e14; border:1px solid var(--focus); }
.friend-row .names .name { font-weight:600; }
.chat-item.unread { position:relative; }
.chat-item.unread::before { content:''; position:absolute; left:4px; top:50%; width:8px; height:8px; border-radius:50%; background:#ffffff; transform:translateY(-50%); }

.file-bubble { display:flex; align-items:center; gap:8px; padding:6px 8px; border:1px solid var(--focus); border-radius:8px; background:#0c0f16; }
.file-bubble .meta { font-size:12px; color:var(--muted); }

.chat-item.unread { padding-left: 22px; }


/* Profile view should span full center width */
.profile-view { width: 100%; }
.profile-view .row { width: 100%; }
.profile-view .select, .profile-view .input, .profile-view .listbox { width: 100%; }


/* Timestamp under message bubbles */
.msg .ts { font-size: 11px; color: #888; margin-top: 3px; }

/* Archive Manager */
.arch-list .arch-row { align-items: center; gap: 8px; margin: 4px 0; }


/* Ensure long messages wrap nicely */
.msg { word-break: break-word; overflow-wrap: anywhere; white-space: pre-wrap; }

/* Full-width variant for settings/self-chat panels */
.msg-full { margin:8px 0; padding:8px 10px; background:#0c0f16; border:1px solid var(--focus); border-radius:8px;
            width:100%; max-width:100%; display:block; }
.msg-full.me { background:#122038; }


/* Status bar segments */
.statusbar { display: flex; align-items: center; gap: 0; }
.statusbar .status-seg { display:flex; align-items:center; gap:8px; padding:0 8px; height:100%; }
.statusbar .status-seg.click { cursor:pointer; user-select:none; }
.statusbar .status-seg:hover { background: rgba(255,255,255,0.03); }
.statusbar .status-sep { padding:0 6px; opacity:.35; display:flex; align-items:center; }
